<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
			"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="sSQL">
	<select id="saList" resultType="sVO">
		SELECT
		    ee.rno, ee.pno, ee.ptt, ee.bceo, ee.today, ee.bcnt
		FROM
		(SELECT
		    rownum rno, e.pno, e.ptt, e.bceo, e.today, e.bcnt
		FROM
		(SELECT
			pno, ptt, bceo, TO_CHAR(today, 'yyyy-mm-dd hh24:mi:ss') today, bcnt
		FROM
			promotion p, boss b
		WHERE
			p.bno = b.bno AND p.pshow = 'Y'
		ORDER BY
			today desc) e) ee
	</select>
	<select id="saDetail" resultType="sVO" >
		SELECT
			p.pno, ptt, pbd, bceo, b.bno, TO_CHAR(p.today, 'yyyy-mm-dd hh24:mi:ss') today, bcnt, bloc, cate, m.memid, b.bname,
			NVL(imgno, 0) imgno, NVL(oriname, 'none') oriname, NVL(savename, 'none') savename
		FROM
			promotion p, image i, boss b, member m
		WHERE
			p.pno = i.pno(+)
			AND b.bno = p.bno
			AND b.memno = m.memno(+) AND p.pshow = 'Y'
			AND p.pno = #{pno}
	</select>
	<insert id="saWrite" parameterType="sVO">
		INSERT INTO
			promotion(pno, ptt, bno, pbd, cate)
		VALUES(
			(SELECT NVL(MAX(pno)+1, 1000) FROM promotion),
			#{ptt},
			(SELECT bno FROM boss b, member m WHERE b.memno = m.memno AND memid = #{memid}),
			#{pbd}, #{cate}
			)
	</insert>
</mapper>